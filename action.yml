name: 'Melos Build Runner'
description: 'Run the Melos Build Runner for Dart/Flutter projects'
author: 'Klarity.app <info@klarity.app>'
branding:
  icon: 'package'
  color: 'purple'

inputs:
  output_paths:
    description: 'Comma-separated list of output file paths generated by the build-runner'
    required: true
  build_runner_command:
    description: 'The build runner command to execute (default: dart pub run build_runner build --delete-conflicting-outputs)'
    required: false
    default: 'dart pub run build_runner build --delete-conflicting-outputs'

runs:
  using: "composite"
  steps:
    - name: Cache Build Runner Output
      uses: actions/cache@v3
      id: melos_build_runner_cache
      with:
        path: ${{ inputs.output_paths }}
        key: melos_build_runner_cache_${{ runner.os }}_${{ github.sha }}

    - name: Setup Melos
      uses: bluefireteam/melos-action@v3
      
    - name: Run Build Runner
      if: steps.melos_build_runner_cache.outputs.cache-hit != 'true'
      run: |
        melos exec -c 1 --depends-on="build_runner" -- \
        "${{ inputs.build_runner_command }}"
      shell: bash
